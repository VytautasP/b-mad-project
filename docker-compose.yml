# TaskFlow Local Development Environment
# Docker Compose configuration for running PostgreSQL locally

version: '3.9'

services:
  # PostgreSQL Database
  postgres:
    image: postgres:15-alpine
    container_name: taskflow-postgres
    restart: unless-stopped
    
    environment:
      POSTGRES_DB: taskflow_dev
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
      POSTGRES_HOST_AUTH_METHOD: scram-sha-256
      POSTGRES_INITDB_ARGS: "--auth-host=scram-sha-256"
    
    ports:
      - "5432:5432"
    
    volumes:
      # Persistent data volume (data survives container restarts)
      - postgres_data:/var/lib/postgresql/data
      # Optional: Mount init scripts
      # - ./scripts/init-db.sql:/docker-entrypoint-initdb.d/01-init.sql
    
    networks:
      - taskflow-network
    
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U postgres -d taskflow_dev"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 10s

  # Optional: pgAdmin for database GUI (uncomment if needed)
  # pgadmin:
  #   image: dpage/pgadmin4:latest
  #   container_name: taskflow-pgadmin
  #   restart: unless-stopped
  #   
  #   environment:
  #     PGADMIN_DEFAULT_EMAIL: admin@taskflow.local
  #     PGADMIN_DEFAULT_PASSWORD: admin
  #     PGADMIN_CONFIG_SERVER_MODE: 'False'
  #   
  #   ports:
  #     - "5050:80"
  #   
  #   networks:
  #     - taskflow-network
  #   
  #   depends_on:
  #     - postgres

volumes:
  postgres_data:
    driver: local
    name: taskflow_postgres_data

networks:
  taskflow-network:
    driver: bridge
    name: taskflow_network

# Usage Instructions:
# ------------------
# Start services:     docker-compose up -d
# Stop services:      docker-compose down
# View logs:          docker-compose logs -f postgres
# Restart database:   docker-compose restart postgres
# Remove all data:    docker-compose down -v (WARNING: deletes database!)
#
# Connection String for appsettings.Development.json:
# "DefaultConnection": "Host=localhost;Port=5432;Database=taskflow_dev;Username=postgres;Password=postgres"
#
# Connect via psql:
# psql -h localhost -p 5432 -U postgres -d taskflow_dev
# Password: postgres
#
# Note: Change POSTGRES_PASSWORD for production environments!
