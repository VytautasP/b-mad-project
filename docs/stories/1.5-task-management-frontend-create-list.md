# Story 1.5: Task Management Frontend - Create and List

## Status

Approved

## Story

**As a** user,
**I want** to create new tasks with a simple form and see all my tasks in a list,
**so that** I can start tracking my work immediately.

## Acceptance Criteria

1. Dashboard page created as default authenticated landing page showing user's tasks
2. "Create Task" button prominently displayed at top of dashboard
3. Task creation form includes fields: Name (required), Description (textarea), Due Date (date picker), Priority (dropdown), Status (dropdown), Type (dropdown)
4. Form validation prevents submission without required Name field
5. Successful task creation adds task to list without full page reload
6. Task list displays tasks in cards or table rows showing: Name, Due Date, Priority, Status, Type
7. Empty state displayed when user has no tasks ("Get started by creating your first task")
8. Loading spinner shown while fetching tasks from API
9. Error messages displayed for API failures (creation failed, load failed)
10. Tasks sorted by CreatedDate descending (newest first) by default
11. Basic responsive layoutâ€”works on mobile, tablet, and desktop
12. Created tasks immediately appear in list confirming successful save

## Tasks / Subtasks

- [ ] **Task 1: Create Task Service** (AC: 3, 5, 9)
  - [ ] Create `src/app/features/tasks/services/task.service.ts`
  - [ ] Implement `getTasks()` method returning Observable<Task[]>
  - [ ] Implement `createTask(dto: TaskCreateDto)` method returning Observable<Task>
  - [ ] Implement `getTaskById(id: string)` method returning Observable<Task>
  - [ ] Configure HttpClient injection
  - [ ] Add proper error handling with catchError operator
  - [ ] Use environment.apiUrl for base URL
  - [ ] Add authorization header via HTTP interceptor (already exists from 1.3)

- [ ] **Task 2: Create Task Models** (AC: 3, 6)
  - [ ] Create `src/app/shared/models/task.model.ts` with Task interface:
    - [ ] id: string (GUID)
    - [ ] name: string
    - [ ] description: string | null
    - [ ] createdDate: Date
    - [ ] modifiedDate: Date
    - [ ] dueDate: Date | null
    - [ ] priority: TaskPriority enum (Low=0, Medium=1, High=2, Critical=3)
    - [ ] status: TaskStatus enum (ToDo=0, InProgress=1, Blocked=2, Waiting=3, Done=4)
    - [ ] progress: number (0-100)
    - [ ] type: TaskType enum (Project=0, Milestone=1, Task=2)
    - [ ] createdByUserId: string
    - [ ] parentTaskId: string | null
  - [ ] Create TaskCreateDto interface matching backend DTO
  - [ ] Create TaskUpdateDto interface matching backend DTO
  - [ ] Create enums: TaskPriority, TaskStatus, TaskType matching backend

- [ ] **Task 3: Create Dashboard Component** (AC: 1, 2)
  - [ ] Create `src/app/features/dashboard/dashboard.component.ts`
  - [ ] Create `src/app/features/dashboard/dashboard.component.html`
  - [ ] Create `src/app/features/dashboard/dashboard.component.scss`
  - [ ] Inject TaskService
  - [ ] Add "Create Task" button at top
  - [ ] Wire button to open task creation form (modal or route)
  - [ ] Set dashboard as default route after login in `app.routes.ts`
  - [ ] Add auth guard to protect dashboard route
  - [ ] Use Angular Material toolbar/header for navigation

- [ ] **Task 4: Create Task Form Component** (AC: 3, 4, 5)
  - [ ] Create `src/app/features/tasks/task-form/task-form.component.ts`
  - [ ] Create `src/app/features/tasks/task-form/task-form.component.html`
  - [ ] Create `src/app/features/tasks/task-form/task-form.component.scss`
  - [ ] Create reactive form with FormBuilder
  - [ ] Add form fields: name (required), description, dueDate, priority, status, type
  - [ ] Add form validation (name required, max lengths)
  - [ ] Implement onSubmit() method that calls TaskService.createTask()
  - [ ] Display validation errors inline
  - [ ] Show loading state during submission
  - [ ] Emit success event or navigate after save
  - [ ] Use Angular Material form controls (mat-form-field, mat-input, mat-select, mat-datepicker)
  - [ ] Clear form after successful submission

- [ ] **Task 5: Create Task List Component** (AC: 6, 7, 8, 10, 11)
  - [ ] Create `src/app/features/tasks/task-list/task-list.component.ts`
  - [ ] Create `src/app/features/tasks/task-list/task-list.component.html`
  - [ ] Create `src/app/features/tasks/task-list/task-list.component.scss`
  - [ ] Inject TaskService
  - [ ] Fetch tasks on component init using TaskService.getTasks()
  - [ ] Display tasks in Angular Material table or card list
  - [ ] Show columns: Name, Due Date, Priority, Status, Type
  - [ ] Implement loading state with mat-spinner
  - [ ] Implement empty state component/template
  - [ ] Sort tasks by CreatedDate descending
  - [ ] Add responsive styling (mobile: cards, desktop: table)
  - [ ] Use async pipe to auto-unsubscribe

- [ ] **Task 6: Integrate Components in Dashboard** (AC: 1, 2, 5, 12)
  - [ ] Add TaskFormComponent to Dashboard (modal via MatDialog or inline)
  - [ ] Add TaskListComponent to Dashboard
  - [ ] Wire "Create Task" button to open TaskFormComponent
  - [ ] On successful task creation, refresh task list
  - [ ] Use MatDialog for modal form OR inline component with toggle
  - [ ] Ensure new task appears in list immediately after creation
  - [ ] Add success notification using MatSnackBar

- [ ] **Task 7: Error Handling and Edge Cases** (AC: 9)
  - [ ] Display error message when API call fails (use MatSnackBar or error-message component)
  - [ ] Handle network errors gracefully
  - [ ] Handle unauthorized errors (token expired) - redirect to login
  - [ ] Handle validation errors from backend
  - [ ] Show user-friendly error messages
  - [ ] Test with backend offline scenario

- [ ] **Task 8: Styling and Responsiveness** (AC: 11)
  - [ ] Apply Angular Material theme
  - [ ] Add responsive breakpoints using Angular Flex Layout or CSS Grid
  - [ ] Mobile view: Stack form fields vertically, use card layout for tasks
  - [ ] Tablet view: 2-column form, card layout for tasks
  - [ ] Desktop view: Side-by-side layout, table for tasks
  - [ ] Add consistent spacing and padding
  - [ ] Test on mobile, tablet, and desktop viewports

- [ ] **Task 9: Testing** (AC: All)
  - [ ] Write unit tests for TaskService (getTasks, createTask)
  - [ ] Write unit tests for Task Form Component (validation, submission)
  - [ ] Write unit tests for Task List Component (loading, empty state, display)
  - [ ] Write unit tests for Dashboard Component (integration)
  - [ ] Mock HttpClient using HttpTestingController
  - [ ] Test error scenarios (API failures)
  - [ ] Aim for >80% code coverage

## Dev Notes

### Technical Context

This story builds upon the authentication system from Stories 1.2-1.3 and the Task API from Story 1.4. The frontend will consume the Task CRUD endpoints to provide users with immediate task management capabilities.

**Key Dependencies:**
- Story 1.3: Auth system provides JWT tokens, HTTP interceptor, and auth guard
- Story 1.4: Task API provides POST /api/tasks and GET /api/tasks endpoints

### Relevant Architecture

**Frontend Structure (from frontend-architecture.md):**
- Use standalone Angular components (Angular 20)
- Follow smart/dumb pattern: Dashboard = smart container, TaskForm/TaskList = presentational
- Place components in `src/app/features/` organized by feature
- Shared components go in `src/app/shared/components/`
- Services go in `src/app/features/tasks/services/`
- Models go in `src/app/shared/models/`

**State Management:**
- Use RxJS BehaviorSubject in TaskService to maintain task list state
- Components subscribe via async pipe to prevent memory leaks
- Emit events when tasks are created to trigger list refresh

**API Integration:**
- All API calls through TaskService
- HTTP interceptor adds Authorization header automatically (from Story 1.3)
- Base API URL from `environment.ts`: `apiUrl: 'http://localhost:5000'` (dev)
- Handle errors via catchError operator, pipe to user-friendly messages

**UI Components (Angular Material 20):**
- MatDialog for modal task form
- MatFormField, MatInput, MatSelect, MatDatepicker for form
- MatTable or MatCard for task list display
- MatSpinner for loading states
- MatSnackBar for notifications
- MatButton for actions

### API Endpoints to Use

**From Story 1.4 Backend:**

1. **GET /api/tasks** - Fetch user's tasks
   - Authorization: Bearer token (required)
   - Returns: Array of TaskResponseDto
   - Query params (later): ?status=InProgress&sortBy=CreatedDate

2. **POST /api/tasks** - Create new task
   - Authorization: Bearer token (required)
   - Body: TaskCreateDto (name, description, dueDate, priority, status, type)
   - Returns: TaskResponseDto (created task)

### Task Model Structure

```typescript
// Enums matching backend
export enum TaskPriority {
  Low = 0,
  Medium = 1,
  High = 2,
  Critical = 3
}

export enum TaskStatus {
  ToDo = 0,
  InProgress = 1,
  Blocked = 2,
  Waiting = 3,
  Done = 4
}

export enum TaskType {
  Project = 0,
  Milestone = 1,
  Task = 2
}

// Full Task interface
export interface Task {
  id: string;
  name: string;
  description: string | null;
  parentTaskId: string | null;
  createdByUserId: string;
  createdDate: Date;
  modifiedDate: Date;
  dueDate: Date | null;
  priority: TaskPriority;
  status: TaskStatus;
  progress: number;
  type: TaskType;
  isDeleted: boolean;
}

// Create DTO
export interface TaskCreateDto {
  name: string;
  description?: string | null;
  parentTaskId?: string | null;
  dueDate?: Date | null;
  priority: TaskPriority;
  status: TaskStatus;
  type: TaskType;
}
```

### Coding Standards to Follow

**From 12-coding-standards.md:**

1. **Component Structure:**
   - Separate .ts, .html, .scss files
   - Container/presentational pattern
   - Max 300 lines per file

2. **TypeScript:**
   - No `any` types, use proper typing
   - Prefer `const` over `let`
   - Enable strict mode
   - Use arrow functions for callbacks

3. **RxJS:**
   - Use async pipe in templates
   - Avoid nested subscriptions, use operators (switchMap, mergeMap)
   - Always unsubscribe or use async pipe

4. **Naming:**
   - Components: PascalCase (TaskListComponent)
   - Files: kebab-case (task-list.component.ts)
   - Variables: camelCase (taskList, isLoading)
   - Methods: camelCase (getTasks(), onSubmit())

5. **Services:**
   - All API calls through services, never direct HttpClient in components
   - Use dependency injection
   - Return Observables, not Promises

6. **Error Handling:**
   - Use HTTP interceptor for global error handling
   - Display user-friendly error messages
   - Never swallow errors silently

### Important Notes from Previous Stories

**From Story 1.3 (Auth Frontend):**
- HTTP interceptor adds Authorization header to all requests
- Auth guard protects dashboard route
- Token stored in AuthService (BehaviorSubject)
- Expired tokens redirect to login automatically

**From Story 1.4 (Task API):**
- Backend enforces authorization: users can only see/modify their own tasks
- Backend validates required fields (name cannot be empty)
- CreatedByUserId is set automatically by backend from JWT token
- Task list endpoint supports filtering by status (use later in Story 1.7)

### Testing

**Testing Standards:**

**Unit Tests (Jasmine + Karma):**
- Test location: Same folder as component, filename: `*.component.spec.ts`
- Test services: Mock HttpClient using HttpClientTestingModule
- Test components: Mock services using Jasmine spies
- Test forms: Validate form validation logic, test invalid/valid states
- Coverage goal: >80%

**Test Structure:**
```typescript
describe('TaskListComponent', () => {
  let component: TaskListComponent;
  let fixture: ComponentFixture<TaskListComponent>;
  let taskService: jasmine.SpyObj<TaskService>;

  beforeEach(async () => {
    const taskServiceSpy = jasmine.createSpyObj('TaskService', ['getTasks']);
    
    await TestBed.configureTestingModule({
      imports: [TaskListComponent], // Standalone component
      providers: [
        { provide: TaskService, useValue: taskServiceSpy }
      ]
    }).compileComponents();

    taskService = TestBed.inject(TaskService) as jasmine.SpyObj<TaskService>;
    fixture = TestBed.createComponent(TaskListComponent);
    component = fixture.componentInstance;
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });

  it('should display tasks when loaded', () => {
    // Test implementation
  });

  it('should show empty state when no tasks', () => {
    // Test implementation
  });

  it('should show loading spinner while fetching', () => {
    // Test implementation
  });
});
```

**Key Testing Scenarios:**
1. TaskService: Mock HTTP responses, test success and error paths
2. TaskFormComponent: Test validation, test submission, test error handling
3. TaskListComponent: Test loading state, test empty state, test task display
4. Dashboard: Test integration of form and list components

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-24 | 1.0 | Initial story creation | Sarah (PO) |
