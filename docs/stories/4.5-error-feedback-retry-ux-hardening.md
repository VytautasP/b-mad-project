# Story 4.5: Error Feedback and Retry UX Hardening

## Status

Ready for Review

## Story

**As a** user,
**I want** clear and actionable error feedback,
**so that** I can recover quickly when partial data fails to load.

## Acceptance Criteria

1. Section-level failures (for example comments) show inline error and retry action.
2. Global error toasts avoid obscuring primary controls.
3. Retry behavior is idempotent and does not duplicate user actions.
4. Loading and empty states are visually distinct from errors.

## Tasks / Subtasks

- [x] Add inline retry components for partial-load sections.
- [x] Reposition or queue toast notifications to avoid overlap.
- [x] Harden retry handlers to prevent duplicate requests.
- [x] Add UX copy for loading/empty/error distinctions.

## Dev Notes

- Priority: P1
- Source specification: `docs/front-end-spec.md`
- Epic backlog reference: `docs/prd/4.0-ux-friendly-ui-refinement-prioritized.md`

## Dev Agent Record

### Agent Model Used
- GPT-5.3-Codex

### Debug Log References
- Targeted tests run: `npm run test -- --watch=false --include=src/app/features/collaboration/comment-thread/comment-thread.component.spec.ts --include=src/app/features/collaboration/activity-log/activity-log.component.spec.ts --include=src/app/features/tasks/components/time-entry-list/time-entry-list.spec.ts`
- Result: story-touched specs passed; unrelated existing test-suite failures remain in other modules.

### Completion Notes
- Added section-level inline error states and Retry actions for comments, activity log, and time log.
- Hardened retry/load handlers with in-flight guards to prevent duplicate concurrent requests.
- Updated loading/empty/error UX copy so each state is visually and semantically distinct.
- Moved global snackbar notifications to bottom positioning to avoid overlapping primary top-page controls.

### File List
- `src/app/core/services/notification.service.ts`
- `src/app/features/collaboration/comment-thread/comment-thread.component.ts`
- `src/app/features/collaboration/comment-thread/comment-thread.component.html`
- `src/app/features/collaboration/comment-thread/comment-thread.component.scss`
- `src/app/features/collaboration/comment-thread/comment-thread.component.spec.ts`
- `src/app/features/collaboration/activity-log/activity-log.component.ts`
- `src/app/features/collaboration/activity-log/activity-log.component.html`
- `src/app/features/collaboration/activity-log/activity-log.component.scss`
- `src/app/features/collaboration/activity-log/activity-log.component.spec.ts`
- `src/app/features/tasks/components/time-entry-list/time-entry-list.ts`
- `src/app/features/tasks/components/time-entry-list/time-entry-list.html`
- `src/app/features/tasks/components/time-entry-list/time-entry-list.css`
- `src/app/features/tasks/components/time-entry-list/time-entry-list.spec.ts`
- `docs/stories/4.5-error-feedback-retry-ux-hardening.md`

### Change Log
- Implemented section-level retry UX and idempotent retry hardening for task detail partial-load sections.
- Adjusted toast positioning to reduce overlap with top-of-page primary controls.
