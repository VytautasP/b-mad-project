# Story 1.6: Task Management Frontend - Edit and Delete

## Status

Approved

## Story

**As a** user,
**I want** to edit task details and delete tasks I no longer need,
**so that** I can keep my task list accurate and up-to-date.

## Story Context

**Existing System Integration:**
- Integrates with: Task API (Story 1.4) endpoints PUT /api/tasks/:id and DELETE /api/tasks/:id
- Integrates with: Existing task-list component (Story 1.5) and TaskService
- Technology: Angular 20 standalone components, Angular Material 20, RxJS, TypeScript 5.9.3
- Follows pattern: Container/Presentational component pattern, reactive forms with FormBuilder
- Touch points: 
  - TaskService (add updateTask and deleteTask methods)
  - TaskListComponent (add edit/delete action handlers)
  - TaskFormComponent (reuse for edit mode with pre-populated values)
  - Angular Material Dialog for confirmation
  - HTTP Interceptor for auth (already exists from Story 1.3)

## Acceptance Criteria

**Functional Requirements:**

1. Edit button/icon added to each task in the list
2. Clicking edit opens task edit form (modal, slide-out panel, or inline edit)
3. Edit form pre-populated with current task values
4. All task fields editable (Name, Description, Due Date, Priority, Status, Type)
5. Save button updates task via API and refreshes list
6. Cancel button closes edit form without saving changes
7. Delete button/icon added to each task with confirmation prompt ("Are you sure?")
8. Confirmed deletion removes task from list immediately

**Integration Requirements:**

9. Successful edit/delete shows brief success notification (toast/snackbar)
10. API errors during edit/delete display user-friendly error messages
11. Edit and delete actions restricted to task owner (frontend enforces, backend validates)

**Quality Requirements:**

12. Keyboard shortcuts: Escape closes edit form, Enter saves (if focus in form)
13. Change is covered by appropriate unit tests
14. Documentation is updated if needed
15. No regression in existing functionality verified

## Tasks / Subtasks

- [ ] **Task 1: Add Edit and Delete Methods to TaskService** (AC: 5, 8, 10)
  - [ ] Add `updateTask(id: string, dto: TaskUpdateDto): Observable<Task>` method
  - [ ] Add `deleteTask(id: string): Observable<void>` method
  - [ ] Add proper error handling with catchError operator
  - [ ] Ensure authorization header is included via existing HTTP interceptor

- [ ] **Task 2: Create Confirmation Dialog Component** (AC: 7)
  - [ ] Create `src/app/shared/components/confirmation-dialog/confirmation-dialog.component.ts`
  - [ ] Create `src/app/shared/components/confirmation-dialog/confirmation-dialog.component.html`
  - [ ] Create `src/app/shared/components/confirmation-dialog/confirmation-dialog.component.scss`
  - [ ] Accept title, message, confirmText, cancelText as inputs via MAT_DIALOG_DATA
  - [ ] Return boolean result (true for confirm, false for cancel)
  - [ ] Style with Angular Material for consistency
  - [ ] Make reusable for other features

- [ ] **Task 3: Enhance TaskFormComponent for Edit Mode** (AC: 2, 3, 4, 5, 6, 12)
  - [ ] Add `@Input() mode: 'create' | 'edit'` property (default 'create')
  - [ ] Add `@Input() taskToEdit: Task | null` property
  - [ ] In ngOnInit, if mode is 'edit' and taskToEdit exists, pre-populate form fields
  - [ ] Update form title dynamically ("Create Task" vs "Edit Task")
  - [ ] Emit taskUpdated event on successful update (separate from taskCreated)
  - [ ] Add keyboard listener for Escape key to close dialog
  - [ ] Add keyboard listener for Enter key to submit form (when focused in input)
  - [ ] Handle date conversion properly (backend returns ISO string, datepicker expects Date object)

- [ ] **Task 4: Add Edit and Delete Actions to TaskListComponent** (AC: 1, 7)
  - [ ] Add "Edit" icon button to each task row/card in task-table.component template
  - [ ] Add "Delete" icon button to each task row/card in task-table.component template
  - [ ] Use Angular Material icons: mat-icon with 'edit' and 'delete' icons
  - [ ] Add tooltip for accessibility: matTooltip="Edit task" and "Delete task"
  - [ ] Emit taskEdit event when edit button clicked
  - [ ] Emit taskDelete event when delete button clicked
  - [ ] Ensure buttons are visually distinct and easy to identify

- [ ] **Task 5: Implement Edit Handler in TaskListComponent (Container)** (AC: 2, 3, 5, 6, 9, 10, 12)
  - [ ] Handle taskEdit event from TaskTableComponent
  - [ ] Open TaskFormComponent in MatDialog with mode='edit' and taskToEdit data
  - [ ] Subscribe to dialog close event to get result
  - [ ] If dialog returns updated task, call TaskService.updateTask()
  - [ ] On successful update, refresh task list (call loadTasks())
  - [ ] Show success notification using MatSnackBar ("Task updated successfully")
  - [ ] On error, display user-friendly error message using MatSnackBar
  - [ ] Handle dialog dismissal (Escape or Cancel) without making API call

- [ ] **Task 6: Implement Delete Handler in TaskListComponent (Container)** (AC: 7, 8, 9, 10)
  - [ ] Handle taskDelete event from TaskTableComponent
  - [ ] Open ConfirmationDialogComponent with appropriate message
  - [ ] Dialog message: "Are you sure you want to delete this task? This action cannot be undone."
  - [ ] Subscribe to dialog close event to get confirmation result
  - [ ] If confirmed (result === true), call TaskService.deleteTask(taskId)
  - [ ] On successful deletion, refresh task list (call loadTasks())
  - [ ] Show success notification using MatSnackBar ("Task deleted successfully")
  - [ ] On error, display user-friendly error message using MatSnackBar

- [ ] **Task 7: Update TaskTableComponent (Presentational)** (AC: 1, 7)
  - [ ] Add 'actions' column to displayedColumns array (if not already present)
  - [ ] Add actions column in template with edit and delete buttons
  - [ ] Wire edit button click to emit taskEdit.emit(task)
  - [ ] Wire delete button click to emit taskDelete.emit(task.id)
  - [ ] Ensure buttons use ChangeDetectionStrategy.OnPush compatible event emission

- [ ] **Task 8: Error Handling and Edge Cases** (AC: 10, 11)
  - [ ] Display error message when update API call fails (use MatSnackBar)
  - [ ] Display error message when delete API call fails (use MatSnackBar)
  - [ ] Handle network errors gracefully
  - [ ] Handle unauthorized errors (token expired) - redirect to login via error interceptor
  - [ ] Handle validation errors from backend (e.g., task name required)
  - [ ] Handle 404 error if task already deleted by another session
  - [ ] Show user-friendly error messages for all error scenarios

- [ ] **Task 9: Styling and UX Polish** (AC: 1, 7, 12)
  - [ ] Style edit and delete buttons consistently with Angular Material theme
  - [ ] Add hover states for action buttons
  - [ ] Position buttons appropriately in table/card layout
  - [ ] Ensure action buttons are accessible on mobile (adequate touch target size)
  - [ ] Add loading state during update/delete operations (disable buttons)
  - [ ] Add fade-out animation when task is deleted from list

- [ ] **Task 10: Testing** (AC: 13, 15)
  - [ ] Write unit tests for TaskService.updateTask() and deleteTask() methods
  - [ ] Write unit tests for ConfirmationDialogComponent
  - [ ] Write unit tests for TaskFormComponent in edit mode (pre-population, submission)
  - [ ] Write unit tests for TaskListComponent edit handler (dialog open, update flow)
  - [ ] Write unit tests for TaskListComponent delete handler (confirmation, deletion flow)
  - [ ] Mock HttpClient using HttpTestingController
  - [ ] Mock MatDialog and MatSnackBar in component tests
  - [ ] Test error scenarios (API failures, validation errors, 404s)
  - [ ] Test keyboard shortcuts (Escape, Enter)
  - [ ] Verify no regression in existing task creation functionality from Story 1.5

## Dev Notes

### Technical Context

This story extends the task management functionality from Story 1.5 by adding edit and delete operations. It reuses the existing TaskFormComponent in edit mode and integrates with the Task API endpoints from Story 1.4.

**Key Dependencies:**
- Story 1.3: Auth system provides JWT tokens via HTTP interceptor
- Story 1.4: Task API provides PUT /api/tasks/:id and DELETE /api/tasks/:id endpoints
- Story 1.5: TaskListComponent, TaskFormComponent, TaskService, Task models already exist

### Relevant Architecture

**Frontend Structure (from frontend-architecture.md):**
- Use standalone Angular components (Angular 20)
- Follow smart/dumb pattern: TaskListComponent = smart container, TaskTableComponent = presentational
- Place reusable ConfirmationDialogComponent in `src/app/shared/components/`
- Use MatDialog for modal dialogs (edit form, confirmation)
- Use MatSnackBar for toast notifications
- TaskFormComponent already exists in `src/app/features/tasks/task-form/`

**Component Communication:**
1. TaskTableComponent (presentational) emits events → TaskListComponent (container) handles logic
2. TaskListComponent opens dialogs (TaskFormComponent for edit, ConfirmationDialogComponent for delete)
3. TaskListComponent calls TaskService methods
4. TaskService makes HTTP calls to backend API

**Existing Patterns to Follow:**
- Reactive forms with FormBuilder (already used in TaskFormComponent)
- Observable pattern with RxJS (already used in TaskService)
- Container/Presentational component pattern (already established in Story 1.5)
- HTTP error handling via interceptor (already exists from Story 1.3)
- Loading states and error messages via MatSnackBar (established pattern)

### Source Tree Locations

**Files to Modify:**
- `src/app/features/tasks/services/task.service.ts` - Add updateTask and deleteTask methods
- `src/app/features/tasks/task-form/task-form.component.ts` - Add edit mode support
- `src/app/features/tasks/task-form/task-form.component.html` - Update title and button text dynamically
- `src/app/features/tasks/task-list/task-list.component.ts` - Add edit and delete handlers
- `src/app/features/tasks/task-list/components/task-table/task-table.component.ts` - Add action column outputs
- `src/app/features/tasks/task-list/components/task-table/task-table.component.html` - Add edit/delete buttons

**Files to Create:**
- `src/app/shared/components/confirmation-dialog/confirmation-dialog.component.ts`
- `src/app/shared/components/confirmation-dialog/confirmation-dialog.component.html`
- `src/app/shared/components/confirmation-dialog/confirmation-dialog.component.scss`
- `src/app/shared/components/confirmation-dialog/confirmation-dialog.component.spec.ts`

**Test Files to Create/Update:**
- `src/app/features/tasks/services/task.service.spec.ts` - Add update/delete test cases
- `src/app/features/tasks/task-form/task-form.component.spec.ts` - Add edit mode test cases
- `src/app/features/tasks/task-list/task-list.component.spec.ts` - Add edit/delete handler tests
- `src/app/shared/components/confirmation-dialog/confirmation-dialog.component.spec.ts`

### Integration Approach

**Reusing TaskFormComponent for Edit:**
The existing TaskFormComponent will be enhanced to support both create and edit modes:
- Add mode input property ('create' | 'edit')
- Add taskToEdit input property
- Pre-populate form when in edit mode
- Change dialog title and button text dynamically
- Emit different events for create vs update (or use single event with mode indicator)

**Dialog-Based Workflow:**
1. User clicks Edit button → TaskListComponent opens MatDialog with TaskFormComponent
2. User modifies fields and clicks Save → TaskFormComponent emits update event → Dialog closes with result
3. TaskListComponent receives result → Calls TaskService.updateTask() → Refreshes list

**Confirmation Dialog Pattern:**
1. User clicks Delete button → TaskListComponent opens ConfirmationDialogComponent
2. User confirms → Dialog closes with true → TaskService.deleteTask() called
3. User cancels → Dialog closes with false → No action taken

### Key Constraints

- Must maintain backward compatibility with existing task creation flow (Story 1.5)
- Edit and delete must respect authorization (backend validates ownership via JWT)
- Changes must follow existing Angular Material styling and theme
- All API calls must go through TaskService (no direct HttpClient usage in components)
- Must use async pipe and proper unsubscribe patterns to prevent memory leaks

### Testing

**Testing Standards from coding-standards.md:**

**Test File Location:**
- Test files must be co-located with component files: `*.component.spec.ts`
- Service test files: `*.service.spec.ts`
- Use Angular testing utilities: TestBed, ComponentFixture, HttpTestingController

**Testing Frameworks:**
- Jasmine for test specs (describe, it, expect)
- Karma for test runner
- Angular testing utilities (@angular/core/testing)

**Testing Patterns:**
- Mock HttpClient using HttpTestingController from @angular/common/http/testing
- Mock MatDialog using jasmine.createSpyObj
- Mock MatSnackBar using jasmine.createSpyObj
- Test both success and error paths
- Test edge cases (empty data, null values, network failures)
- Verify no memory leaks (subscriptions cleaned up)

**Coverage Goals:**
- Aim for >80% code coverage
- Cover all public methods
- Cover error handling paths
- Cover user interaction flows (button clicks, form submissions)

**Specific Test Cases Required:**
1. TaskService.updateTask() - success response returns updated task
2. TaskService.updateTask() - error response throws error
3. TaskService.deleteTask() - success response completes
4. TaskService.deleteTask() - error response throws error
5. ConfirmationDialogComponent - renders with correct message
6. ConfirmationDialogComponent - returns true on confirm
7. ConfirmationDialogComponent - returns false on cancel
8. TaskFormComponent - pre-populates fields when mode='edit'
9. TaskFormComponent - submits update when mode='edit'
10. TaskFormComponent - closes on Escape key
11. TaskFormComponent - submits on Enter key
12. TaskListComponent - opens edit dialog with correct data
13. TaskListComponent - calls updateTask on dialog close with data
14. TaskListComponent - opens delete confirmation dialog
15. TaskListComponent - calls deleteTask on confirmation
16. TaskListComponent - does not call deleteTask on cancel
17. TaskListComponent - shows success notification on update
18. TaskListComponent - shows success notification on delete
19. TaskListComponent - shows error notification on API failure
20. TaskTableComponent - emits taskEdit event on edit button click
21. TaskTableComponent - emits taskDelete event on delete button click

## Risk and Compatibility Check

**Minimal Risk Assessment:**
- **Primary Risk:** Breaking existing task creation functionality when modifying TaskFormComponent
- **Mitigation:** Add mode property with default value 'create' to maintain backward compatibility, comprehensive unit tests for both modes
- **Rollback:** Revert TaskFormComponent changes, remove edit/delete buttons, remove confirmation dialog

**Compatibility Verification:**
- [x] No breaking changes to existing APIs (only adding methods to TaskService)
- [x] Database changes - none required (API endpoints already exist from Story 1.4)
- [x] UI changes follow existing design patterns (Angular Material, existing task list layout)
- [x] Performance impact is negligible (single task update/delete operations)

## Validation Checklist

**Scope Validation:**
- [x] Story can be completed in one development session (4-6 hours estimated)
- [x] Integration approach is straightforward (reuse existing components and service)
- [x] Follows existing patterns exactly (container/presentational, reactive forms, MatDialog)
- [x] No design or architecture work required (patterns established in Story 1.5)

**Clarity Check:**
- [x] Story requirements are unambiguous (specific AC with clear UI actions)
- [x] Integration points are clearly specified (TaskService, TaskFormComponent, API endpoints)
- [x] Success criteria are testable (observable user actions and API calls)
- [x] Rollback approach is simple and feasible (revert file changes)

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-25 | 1.0 | Initial story creation | Sarah (Product Owner) |

## Dev Agent Record

### Agent Model Used

_Not yet populated - awaiting development agent assignment_

### Debug Log References

_Not yet populated - awaiting development agent execution_

### Completion Notes List

_Not yet populated - awaiting development agent execution_

### File List

_Not yet populated - awaiting development agent execution_

## QA Results

_Not yet populated - awaiting QA agent review_
