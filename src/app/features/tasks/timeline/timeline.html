<div class="timeline-container">
  <!-- Header -->
  <div class="timeline-header">
    <h1>Task Timeline</h1>
    
    <!-- View Mode Controls -->
    <div class="view-controls">
      <mat-button-toggle-group
        [value]="viewMode()"
        (change)="changeViewMode($event.value)"
        aria-label="Timeline granularity"
      >
        <mat-button-toggle
          value="day"
          [class.view-toggle-active]="viewMode() === 'day'"
          aria-label="Day view"
        >
          <mat-icon>today</mat-icon>
          Day
        </mat-button-toggle>
        <mat-button-toggle
          value="week"
          [class.view-toggle-active]="viewMode() === 'week'"
          aria-label="Week view"
        >
          <mat-icon>view_week</mat-icon>
          Week
        </mat-button-toggle>
        <mat-button-toggle
          value="month"
          [class.view-toggle-active]="viewMode() === 'month'"
          aria-label="Month view"
        >
          <mat-icon>calendar_month</mat-icon>
          Month
        </mat-button-toggle>
      </mat-button-toggle-group>
    </div>
  </div>

  <!-- Loading Bar -->
  @if (isLoading()) {
    <mat-progress-bar mode="indeterminate"></mat-progress-bar>
  }

  <!-- Loading State -->
  @if (isLoading() && tasks().length === 0) {
    <div class="loading-container">
      <mat-spinner></mat-spinner>
      <p>Loading timeline...</p>
    </div>
  }

  <!-- Empty State -->
  @if (!isLoading() && tasks().length === 0) {
    <app-timeline-empty-state
      [noDueDateCount]="noDueDateCount()"
      [invalidDueDateCount]="invalidDueDateCount()"
      (ctaClick)="onAddDueDateCta()"
    ></app-timeline-empty-state>
  }

  <!-- Timeline Chart Container -->
  @if (!isLoading() && tasks().length > 0) {
    <div class="timeline-wrapper">
      <div #timelineContainer class="timeline-chart"></div>

      @if (isMobile()) {
        <section class="timeline-touch-controls" aria-label="Timeline date controls">
          <h2>Adjust dates without drag</h2>
          <div class="touch-task-list">
            @for (task of tasks(); track task.id) {
              <article class="touch-task-item">
                <div class="touch-task-meta">
                  <strong>{{ task.name }}</strong>
                  <span>{{ getStatusLabel(task.status) }} â€¢ {{ task.dueDate | date:'mediumDate' }}</span>
                </div>
                <div class="touch-actions">
                  <button
                    mat-stroked-button
                    type="button"
                    (click)="moveTaskByDays(task, -1)"
                    [disabled]="!canAdjustTaskDate(task) || isUpdating()"
                    aria-label="Move due date one day earlier">
                    <mat-icon>remove</mat-icon>
                    1 day
                  </button>
                  <button
                    mat-stroked-button
                    type="button"
                    (click)="moveTaskByDays(task, 1)"
                    [disabled]="!canAdjustTaskDate(task) || isUpdating()"
                    aria-label="Move due date one day later">
                    <mat-icon>add</mat-icon>
                    1 day
                  </button>
                </div>
              </article>
            }
          </div>
        </section>
      }
    </div>
  }
</div>
