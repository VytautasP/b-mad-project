<div class="task-list-container">
  @if (isLoading) {
    <div class="loading-container">
      <mat-spinner></mat-spinner>
      <p>Loading tasks...</p>
    </div>
  } @else {
    @let tasks = (tasks$ | async);
    @if (tasks) {
      @if (tasks.length === 0) {
        <div class="empty-state">
          <h2>No tasks yet</h2>
          <p>Get started by creating your first task</p>
        </div>
      } @else {
        <!-- Desktop view: Table -->
        <div class="desktop-view">
          <mat-table [dataSource]="tasks" class="task-table">
            <!-- Name Column -->
            <ng-container matColumnDef="name">
              <mat-header-cell *matHeaderCellDef>Task Name</mat-header-cell>
              <mat-cell *matCellDef="let task">
                <div class="task-name">
                  <strong>{{ task.name }}</strong>
                  @if (task.description) {
                    <small>{{ task.description }}</small>
                  }
                </div>
              </mat-cell>
            </ng-container>

            <!-- Due Date Column -->
            <ng-container matColumnDef="dueDate">
              <mat-header-cell *matHeaderCellDef>Due Date</mat-header-cell>
              <mat-cell *matCellDef="let task">{{ formatDate(task.dueDate) }}</mat-cell>
            </ng-container>

            <!-- Priority Column -->
            <ng-container matColumnDef="priority">
              <mat-header-cell *matHeaderCellDef>Priority</mat-header-cell>
              <mat-cell *matCellDef="let task">
                <mat-chip [color]="getPriorityColor(task.priority)">
                  {{ getPriorityLabel(task.priority) }}
                </mat-chip>
              </mat-cell>
            </ng-container>

            <!-- Status Column -->
            <ng-container matColumnDef="status">
              <mat-header-cell *matHeaderCellDef>Status</mat-header-cell>
              <mat-cell *matCellDef="let task">
                <mat-chip [color]="getStatusColor(task.status)">
                  {{ getStatusLabel(task.status) }}
                </mat-chip>
              </mat-cell>
            </ng-container>

            <!-- Type Column -->
            <ng-container matColumnDef="type">
              <mat-header-cell *matHeaderCellDef>Type</mat-header-cell>
              <mat-cell *matCellDef="let task">{{ getTypeLabel(task.type) }}</mat-cell>
            </ng-container>

            <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
            <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>
          </mat-table>
        </div>

        <!-- Mobile view: Cards -->
        <div class="mobile-view">
          @for (task of tasks; track task.id) {
            <mat-card class="task-card">
              <mat-card-header>
                <mat-card-title>{{ task.name }}</mat-card-title>
              </mat-card-header>
              <mat-card-content>
                @if (task.description) {
                  <p class="task-description">{{ task.description }}</p>
                }
                <div class="task-details">
                  <div class="detail-row">
                    <span class="label">Due Date:</span>
                    <span>{{ formatDate(task.dueDate) }}</span>
                  </div>
                  <div class="detail-row">
                    <span class="label">Priority:</span>
                    <mat-chip [color]="getPriorityColor(task.priority)">
                      {{ getPriorityLabel(task.priority) }}
                    </mat-chip>
                  </div>
                  <div class="detail-row">
                    <span class="label">Status:</span>
                    <mat-chip [color]="getStatusColor(task.status)">
                      {{ getStatusLabel(task.status) }}
                    </mat-chip>
                  </div>
                  <div class="detail-row">
                    <span class="label">Type:</span>
                    <span>{{ getTypeLabel(task.type) }}</span>
                  </div>
                </div>
              </mat-card-content>
            </mat-card>
          }
        </div>
      }
    }
  }
</div>
